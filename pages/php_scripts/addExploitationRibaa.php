<?php

	session_start();
	$db = pg_connect('host=localhost dbname=MHAI_DH user=postgres password=P0stgres');
	if (!$db){
		die("no connection to database ". pg_last_error());
	}

	$ID_Ribaa=pg_escape_string($_POST['ID_Ribaa']);
	$Beneficiaire=pg_escape_string($_POST['Beneficiaire']);
	$Num_Accord=pg_escape_string($_POST['Num_Accord']);
	$Date_Accord=pg_escape_string($_POST['Date_Accord']);
	$Description=pg_escape_string($_POST['Description']);
	$Rente=pg_escape_string($_POST['Rente']);
	$Duree_Rente=pg_escape_string($_POST['Duree_Rente']);
	$Prix_Vente=pg_escape_string($_POST['Prix_Vente']);
	$userID=$_SESSION['userID'];

	$query = "INSERT INTO exploitation_ribaa (id_ribaa, beneficiaire, num_accord, date_accord, description, rente, duree_rente, prix_vente) VALUES('" . $ID_Ribaa . "', '" . $Beneficiaire . "', '" . $Num_Accord ."', '" . $Date_Accord ."', '" . $Description . "', '" . $Rente ."', '" . $Duree_Rente ."', '" . $Prix_Vente ."')";
	$result = pg_query($query);
	if (!$result) {
		$errormessage = pg_last_error();
		echo "Error with query: " . $errormessage;
		exit();
	}

	$querylog = "INSERT INTO operation (utilisateur_id, description, time, entite_id, table_op) VALUES('" . $userID . "', 'Nouvelle Exploitation de ribaa', localtimestamp, currval('exploitation_ribaa_id_seq'), 'exploitation_ribaa')";
	$resultlog = pg_query($querylog);
		if (!$resultlog) {
			$errormessage = pg_last_error();
			echo "Error with query: " . $errormessage;
			exit();
		}

	echo "success";
	pg_close();
?> 
